<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      layout:decorate="~{base}">
    <head>
        <title th:text="${modo == 'editar' ? 'Editar Producto' : 'Nuevo Producto'} + ' | Sistema CV'">
            Formulario Producto | Sistema CV
        </title>

        <!-- Estilos específicos para formulario de productos -->
    <th:block layout:fragment="styles">
        <link rel="stylesheet" th:href="@{/css/StylePF.css}">
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="card card-custom mt-4">
                        <div class="card-header card-header-custom d-flex justify-content-between align-items-center">
                            <h4 class="mb-0">
                                <i class="fas" th:classappend="${modo == 'editar' ? 'fa-edit' : 'fa-plus'}" th:text="${modo == 'editar' ? 'fa-edit me-2' : 'fa-plus me-2'"></i>
                                <span th:text="${modo == 'editar' ? 'Editar Producto' : 'Nuevo Producto'}"></span>
                            </h4>
                            <a th:href="@{/productos}" class="btn btn-outline-custom btn-sm">
                                <i class="fas fa-arrow-left me-1"></i> Volver
                            </a>
                        </div>
                        <div class="card-body">
                            <!-- Mensajes de éxito y error -->
                            <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show" role="alert">
                                <i class="fas fa-check-circle me-2"></i>
                                <span th:text="${mensaje}"></span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>

                            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                <span th:text="${error}"></span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>

                            <form th:action="${modo == 'editar' ? @{'/productos/actualizar/' + ${producto.idProducto}} : @{/productos/guardar}}" 
                                  method="post" 
                                  enctype="multipart/form-data"
                                  id="productoForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <!-- Código -->
                                        <div class="mb-3">
                                            <label for="codigo" class="form-label">Código *</label>
                                            <input type="text" class="form-control" id="codigo" name="codigo" 
                                                   th:value="${producto.codigo}" 
                                                   required
                                                   maxlength="50">
                                            <div class="form-text">Código único del producto</div>
                                        </div>

                                        <!-- Nombre -->
                                        <div class="mb-3">
                                            <label for="nombre" class="form-label">Nombre del Producto *</label>
                                            <input type="text" class="form-control" id="nombre" name="nombre" 
                                                   th:value="${producto.nombre}" 
                                                   required
                                                   maxlength="50">
                                        </div>

                                        <!-- Color -->
                                        <div class="mb-3">
                                            <label for="color" class="form-label">Color</label>
                                            <input type="text" class="form-control" id="color" name="color" 
                                                   th:value="${producto.color}" 
                                                   maxlength="30">
                                        </div>

                                        <!-- Categoría -->
                                        <div class="mb-3">
                                            <label for="categoria.idCategoria" class="form-label">Categoría *</label>
                                            <select class="form-select" id="categoria.idCategoria" name="categoria.idCategoria" required>
                                                <option value="">Seleccionar categoría</option>
                                                <option th:each="categoria : ${categorias}"
                                                        th:value="${categoria.idCategoria}"
                                                        th:text="${categoria.nombre}"
                                                        th:selected="${producto.categoria != null and producto.categoria.idCategoria == categoria.idCategoria}">
                                                </option>
                                            </select>
                                        </div>

                                        <!-- Acabado -->
                                        <div class="mb-3">
                                            <label for="acabado" class="form-label">Acabado</label>
                                            <select class="form-select" id="acabado" name="acabado">
                                                <option value="">Seleccionar Acabado</option>
                                                <option value="Brillante" th:selected="${producto.acabado == 'Brillante'}">Brillante</option>
                                                <option value="Semibrillante" th:selected="${producto.acabado == 'Semibrillante'}">Semibrillante</option>
                                                <option value="Mate" th:selected="${producto.acabado == 'Mate'}">Mate</option>
                                                <option value="Antideslizante" th:selected="${producto.acabado == 'Antideslizante'}">Antideslizante</option>
                                                <option value="Rustico" th:selected="${producto.acabado == 'Rustico'}">Rustico</option>
                                            </select>
                                        </div>

                                        <!-- Descripción -->
                                        <div class="mb-3">
                                            <label for="descripcion" class="form-label">Descripción</label>
                                            <textarea class="form-control" id="descripcion" name="descripcion" rows="3" 
                                                      th:text="${producto.descripcion}"></textarea>
                                        </div>

                                        <!-- Rectificado -->
                                        <div class="mb-3 form-check form-switch">
                                            <input type="checkbox" class="form-check-input" id="rectificado" name="rectificado" 
                                                   th:checked="${producto.rectificado == '1'}">
                                            <label class="form-check-label" for="rectificado">Rectificado</label>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <!-- Precio -->
                                        <div class="mb-3">
                                            <label for="precio" class="form-label">Precio Unitario *</label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" step="0.01" min="0" class="form-control" id="precio" name="precio" 
                                                       th:value="${producto.precio}" 
                                                       required>
                                            </div>
                                        </div>

                                        <!-- Unidad de Medida -->
                                        <div class="mb-3">
                                            <label for="unidadMedida" class="form-label">Unidad de Medida (MT)</label>
                                            <input type="text" class="form-control" id="unidadMedida" name="unidadMedida" 
                                                   th:value="${producto.unidadMedida}" 
                                                   maxlength="10">
                                            <div class="form-text">Ej: M2, UND, KG, etc.</div>
                                        </div>

                                        <!-- Stock -->
                                        <div class="mb-3">
                                            <label for="stock" class="form-label">Stock Inicial *</label>
                                            <input type="number" class="form-control" id="stock" name="stock" 
                                                   th:value="${producto.stock != null ? producto.stock : 0}" 
                                                   min="0" required>
                                        </div>

                                        <!-- Ubicación -->
                                        <div class="mb-3">
                                            <label for="ubicacion" class="form-label">Ubicación en Almacén</label>
                                            <input type="text" class="form-control" id="ubicacion" name="ubicacion" 
                                                   th:value="${producto.ubicacion}" 
                                                   maxlength="50">
                                        </div>

                                        <!-- Tráfico -->
                                        <div class="mb-3">
                                            <label for="trafico" class="form-label">Tráfico</label>
                                            <select class="form-select" id="trafico" name="trafico">
                                                <option value="">Seleccionar Tráfico</option>
                                                <option value="Comercial Alto" th:selected="${producto.trafico == 'Comercial Alto'}">Comercial Alto</option>
                                                <option value="Comercial Bajo" th:selected="${producto.trafico == 'Comercial Bajo'}">Comercial Bajo</option>
                                                <option value="Comercial Medio" th:selected="${producto.trafico == 'Comercial Medio'}">Comercial Medio</option>
                                                <option value="Residencial Alto" th:selected="${producto.trafico == 'Residencial Alto'}">Residencial Alto</option>
                                                <option value="Residencial Medio" th:selected="${producto.trafico == 'Residencial Medio'}">Residencial Medio</option>
                                            </select>
                                        </div>

                                        <!-- Proveedor -->
                                        <div class="mb-3">
                                            <label for="proveedor.idProveedor" class="form-label">Proveedor</label>
                                            <select class="form-select" id="proveedor.idProveedor" name="proveedor.idProveedor">
                                                <option value="">Seleccionar proveedor</option>
                                                <option th:each="proveedor : ${proveedores}"
                                                        th:value="${proveedor.idProveedor}"
                                                        th:text="${proveedor.nombre}"
                                                        th:selected="${producto.proveedor != null and producto.proveedor.idProveedor == proveedor.idProveedor}">
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Imagen -->
                                <div class="mb-3">
                                    <label for="imagen" class="form-label">Imagen del Producto</label>
                                    <input class="form-control" type="file" id="imagen" name="imagen" accept="images/*">
                                    <div class="form-text">Formatos aceptados: JPG, PNG, GIF. Tamaño máximo: 5MB</div>
                                    <th:block th:if="${producto.imagen != null}">
                                        <div class="mt-2">
                                            <small class="text-muted">Imagen actual: </small>
                                            <span th:text="${producto.imagen}" class="fw-medium"></span>
                                        </div>
                                    </th:block>
                                </div>

                                <!-- Vista previa de imagen -->
                                <div class="mb-3" id="imagenPreviewContainer" style="display: none;">
                                    <label class="form-label">Vista Previa</label>
                                    <div>
                                        <img id="imagenPreview" class="img-thumbnail" style="max-height: 200px;">
                                    </div>
                                </div>

                                <!-- Botones de acción -->
                                <div class="d-flex justify-content-end gap-2 mt-4">
                                    <a th:href="@{/productos}" class="btn btn-secondary">
                                        <i class="fas fa-times me-1"></i>Cancelar
                                    </a>
                                    <button type="submit" class="btn btn-custom">
                                        <i class="fas fa-save me-1"></i>
                                        <span th:text="${modo == 'editar' ? 'Actualizar' : 'Guardar'} + ' Producto'"></span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts específicos para formulario de productos -->
<th:block layout:fragment="scripts">
    <script th:src="@{/js/productoFormulario.js}"></script>
</th:block>
</body>
</html>