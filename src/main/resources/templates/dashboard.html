<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">
    <head>
        <title>Dashboard - Sistema de Gestión Comercial</title>

        <!-- Estilos específicos para dashboard -->
    <th:block layout:fragment="styles">
        <link rel="stylesheet" th:href="@{/css/StyleDB.css}">
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    </th:block>
</head>

<body>
    <!-- Contenido principal -->
    <div layout:fragment="content">
        <div class="container-fluid">
            <!-- Alertas -->
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert" data-aos="fade-down">
                <span th:text="${success}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert" data-aos="fade-down">
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Cards de métricas -->
            <div class="row mb-4" data-aos="fade-up">
                <div class="col-md-3">
                    <div class="dashboard-card">
                        <div class="card-body">
                            <h5 class="card-title">Clientes Activos</h5>
                            <h2 class="card-text" th:text="${metricas != null and metricas.totalClientesActivos != null ? metricas.totalClientesActivos : '0'}">0</h2>
                            <p class="card-text text-success small">
                                <i class="fas fa-arrow-up me-1"></i>
                                <span th:text="${metricas != null and metricas.crecimientoClientes != null ? metricas.crecimientoClientes : '0'}">0</span>% este mes
                            </p>
                        </div>
                        <div class="card-icon"><i class="fas fa-users"></i></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card">
                        <div class="card-body">
                            <h5 class="card-title">Cotizaciones</h5>
                            <h2 class="card-text" th:text="${metricas != null and metricas.totalCotizaciones != null ? metricas.totalCotizaciones : '0'}">0</h2>
                            <p class="card-text text-success small">
                                <i class="fas fa-arrow-up me-1"></i>
                                <span th:text="${metricas != null and metricas.crecimientoCotizaciones != null ? metricas.crecimientoCotizaciones : '0'}">0</span>% este mes
                            </p>
                        </div>
                        <div class="card-icon"><i class="fas fa-file-invoice-dollar"></i></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card">
                        <div class="card-body">
                            <h5 class="card-title">Ventas Totales</h5>
                            <h2 class="card-text" th:text="${metricas != null and metricas.ventasTotales != null ? '$' + #numbers.formatDecimal(metricas.ventasTotales, 0, 'DEFAULT', 0, 'DEFAULT') : '$0'}">$0</h2>
                            <p class="card-text text-success small">
                                <i class="fas fa-arrow-up me-1"></i>
                                <span th:text="${metricas != null and metricas.crecimientoVentas != null ? metricas.crecimientoVentas : '0'}">0</span>% este mes
                            </p>
                        </div>
                        <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card">
                        <div class="card-body">
                            <h5 class="card-title">Productos</h5>
                            <h2 class="card-text" th:text="${metricas != null and metricas.totalProductos != null ? metricas.totalProductos : '0'}">0</h2>
                            <p class="card-text text-success small">
                                <i class="fas fa-arrow-up me-1"></i>
                                <span th:text="${metricas != null and metricas.crecimientoProductos != null ? metricas.crecimientoProductos : '0'}">0</span>% este mes
                            </p>
                        </div>
                        <div class="card-icon"><i class="fas fa-boxes"></i></div>
                    </div>
                </div>
            </div>

            <!-- Acciones Rápidas -->
            <div class="row mb-4" data-aos="fade-up" data-aos-delay="100">
                <div class="col-12">
                    <div class="stats-container">
                        <h5 class="mb-4">Acciones Rápidas</h5>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <a th:href="@{/clientes/nuevo}" class="quick-action text-decoration-none">
                                    <i class="fas fa-plus action-primary"></i>
                                    <h6 class="text-dark">Nuevo Cliente</h6>
                                    <small class="text-muted">Registrar nuevo cliente</small>
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a th:href="@{/cotizaciones/nueva}" class="quick-action text-decoration-none">
                                    <i class="fas fa-file-invoice action-accent"></i>
                                    <h6 class="text-dark">Crear Cotización</h6>
                                    <small class="text-muted">Generar nueva cotización</small>
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a th:href="@{/productos}" class="quick-action text-decoration-none">
                                    <i class="fas fa-box action-success"></i>
                                    <h6 class="text-dark">Ver Productos</h6>
                                    <small class="text-muted">Verificar disponibilidad</small>
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a th:href="@{/informes}" class="quick-action text-decoration-none">
                                    <i class="fas fa-chart-pie action-danger"></i>
                                    <h6 class="text-dark">Ver Reportes</h6>
                                    <small class="text-muted">Analizar estadísticas</small>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráfico y Actividad -->
            <div class="row" data-aos="fade-up" data-aos-delay="200">
                <div class="col-md-8 mb-4">
                    <div class="stats-container">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="mb-0">Ventas Mensuales</h5>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="chartDropdown" data-bs-toggle="dropdown">
                                    Últimos 12 meses
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="chartDropdown">
                                    <li><a class="dropdown-item" href="#" data-period="6">Últimos 6 meses</a></li>
                                    <li><a class="dropdown-item" href="#" data-period="12">Últimos 12 meses</a></li>
                                    <li><a class="dropdown-item" href="#" data-period="ytd">Este año</a></li>
                                    <li><a class="dropdown-item" href="#" data-period="lastYear">Año anterior</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="salesChart"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #cb9a28;"></div>
                                <small>Ventas Totales</small>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #000000;"></div>
                                <small>Objetivo</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="stats-container">
                        <h5 class="mb-4">Actividad Reciente</h5>
                        <div class="activity-item">
                            <div class="activity-dot"></div>
                            <div>
                                <h6>Nueva cotización</h6>
                                <p class="text-muted small">Constructora Andina - $28.450.000</p>
                                <small class="text-muted">Hace 15 minutos</small>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-dot"></div>
                            <div>
                                <h6>Cliente registrado</h6>
                                <p class="text-muted small">Arq. María Pérez</p>
                                <small class="text-muted">Hace 2 horas</small>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-dot"></div>
                            <div>
                                <h6>Venta realizada</h6>
                                <p class="text-muted small">Porcelanato Marmol - $9.200.000</p>
                                <small class="text-muted">Hoy, 10:45 AM</small>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-dot"></div>
                            <div>
                                <h6>Stock actualizado</h6>
                                <p class="text-muted small">Cerámica Madrid 60x60</p>
                                <small class="text-muted">Ayer, 5:30 PM</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Últimas Cotizaciones -->
            <div class="row" data-aos="fade-up" data-aos-delay="300">
                <div class="col-12">
                    <div class="stats-container">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="mb-0">Últimas Cotizaciones</h5>
                            <a th:href="@{/cotizaciones}" class="btn btn-sm btn-outline-custom">Ver Todas</a>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>N° Cotización</th>
                                        <th>Cliente</th>
                                        <th>Fecha</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:if="${ultimasCotizaciones == null || #lists.isEmpty(ultimasCotizaciones)}">
                                        <td colspan="6" class="text-center py-4">
                                            <div class="text-muted">
                                                <i class="fas fa-file-invoice fa-3x mb-3"></i>
                                                <h5>No hay cotizaciones recientes</h5>
                                                <p>No se encontraron cotizaciones en el sistema.</p>
                                                <a th:href="@{/cotizaciones/nueva}" class="btn btn-custom">
                                                    <i class="fas fa-plus me-2"></i>Crear Primera Cotización
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr th:each="cotizacion : ${ultimasCotizaciones}">
                                        <td th:text="${cotizacion.codigo}">COT-2025-00125</td>
                                        <td th:text="${cotizacion.cliente != null ? cotizacion.cliente.nombreCompleto : 'N/A'}">Constructora Andina S.A.</td>
                                        <td th:text="${cotizacion.fecha != null ? #temporals.format(cotizacion.fecha, 'dd/MM/yyyy') : 'N/A'}">15/05/2025</td>
                                        <td th:text="${cotizacion.total != null ? '$' + #numbers.formatDecimal(cotizacion.total, 0, 'DEFAULT', 0, 'DEFAULT') : '$0'}">$38.450.000</td>
                                        <td>
                                            <span th:class="${cotizacion.estado == 'APROBADA' ? 'badge bg-success' : 
                                                  cotizacion.estado == 'PENDIENTE' ? 'badge bg-warning' : 
                                                  'badge bg-danger'}"
                                                  th:text="${cotizacion.estado != null ? cotizacion.estado : 'PENDIENTE'}">Aprobada</span>
                                        </td>
                                        <td>
                                            <a th:href="@{/cotizaciones/{id}(id=${cotizacion.idCotizacion})}" 
                                               class="btn btn-sm btn-outline-secondary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts específicos para dashboard -->
<th:block layout:fragment="scripts">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script th:src="@{/js/dashboard.js}"></script>
</th:block>
</body>
</html>